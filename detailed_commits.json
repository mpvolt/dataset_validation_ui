[
  {
    "commit_url": "https://github.com/frogworksio/anyrand/commit/c529cb8fc697d60a6165c34815623c82f500cc3a",
    "sha": "c529cb8fc697d60a6165c34815623c82f500cc3a",
    "parent_sha": "c6f563fe90a7b35dc6d44827c0d3374751633819",
    "message": "test reentrance",
    "score": 0,
    "files": [
      {
        "filename": "contracts/example/AnyrandConsumer.sol",
        "status": "modified",
        "additions": 6,
        "deletions": 0,
        "changes": 6,
        "blob_url_before": "https://github.com/frogworksio/anyrand/blob/c6f563fe90a7b35dc6d44827c0d3374751633819/contracts/example/AnyrandConsumer.sol",
        "blob_url_after": "https://github.com/frogworksio/anyrand/blob/c529cb8fc697d60a6165c34815623c82f500cc3a/contracts/example/AnyrandConsumer.sol",
        "hunks": [
          {
            "header": "@@ -50,4 +50,10 @@ contract AnyrandConsumer is Ownable, IRandomiserCallback {",
            "old_start_line": 50,
            "old_line_count": 4,
            "new_start_line": 50,
            "new_line_count": 10,
            "context": "contract AnyrandConsumer is Ownable, IRandomiserCallback {",
            "lines": [
              "         require(randomness[requestId] == 1, \"Unknown requestId\");",
              "         randomness[requestId] = randomWords[0];",
              "     }",
              "+",
              "+    function getRandomReentrant(",
              "+        uint256 requestId",
              "+    ) external view returns (uint256) {",
              "+        return randomness[requestId];",
              "+    }",
              " }"
            ]
          }
        ]
      },
      {
        "filename": "contracts/test/ReentrantFulfiller.sol",
        "status": "added",
        "additions": 71,
        "deletions": 0,
        "changes": 71,
        "blob_url_before": null,
        "blob_url_after": "https://github.com/frogworksio/anyrand/blob/c529cb8fc697d60a6165c34815623c82f500cc3a/contracts/test/ReentrantFulfiller.sol",
        "hunks": [
          {
            "header": "@@ -0,0 +1,71 @@",
            "old_start_line": 0,
            "old_line_count": 0,
            "new_start_line": 1,
            "new_line_count": 71,
            "context": null,
            "lines": [
              "+// SPDX-License-Identifier: UNLICENSED",
              "+pragma solidity 0.8.23;",
              "+",
              "+import {IRandomiserCallback} from \"../interfaces/IRandomiserCallback.sol\";",
              "+import {Anyrand} from \"../Anyrand.sol\";",
              "+",
              "+/// @title ReentrantFulfiler",
              "+contract ReentrantFulfiler is IRandomiserCallback {",
              "+    /// @notice Anyrand instance",
              "+    address public immutable anyrand;",
              "+    /// @notice Recorded randomness. A special value of 1 means the request is",
              "+    ///     inflight",
              "+    mapping(uint256 requestId => uint256) public randomness;",
              "+",
              "+    event RandomnessReceived(uint256 randomness);",
              "+",
              "+    constructor(address anyrand_) {",
              "+        anyrand = anyrand_;",
              "+    }",
              "+",
              "+    receive() external payable {}",
              "+",
              "+    /// @notice Request a random number, calling back to this contract",
              "+    function getRandom(uint256 deadline, uint256 callbackGasLimit) public {",
              "+        require(deadline > block.timestamp, \"Deadline is in the past\");",
              "+        uint256 requestPrice = Anyrand(anyrand).getRequestPrice(",
              "+            callbackGasLimit",
              "+        );",
              "+        uint256 requestId = Anyrand(anyrand).requestRandomness{",
              "+            value: requestPrice",
              "+        }(deadline, callbackGasLimit);",
              "+        randomness[requestId] = 1;",
              "+    }",
              "+",
              "+    /// @notice Request a random number, calling back to this contract",
              "+    function fulfillRandomness(",
              "+        uint256 requestId,",
              "+        bytes32 pubKeyHash,",
              "+        uint256 round,",
              "+        uint256 callbackGasLimit,",
              "+        uint256[2] memory signature",
              "+    ) public {",
              "+        Anyrand(anyrand).fulfillRandomness(",
              "+            requestId,",
              "+            address(this),",
              "+            pubKeyHash,",
              "+            round,",
              "+            callbackGasLimit,",
              "+            signature",
              "+        );",
              "+    }",
              "+",
              "+    /// @notice See {IRandomiserCallback-receiveRandomWords}",
              "+    function receiveRandomWords(",
              "+        uint256 requestId,",
              "+        uint256[] calldata randomWords",
              "+    ) external {",
              "+        require(msg.sender == anyrand, \"Only callable by Anyrand\");",
              "+        require(randomness[requestId] == 1, \"Unknown requestId\");",
              "+        randomness[requestId] = randomWords[0];",
              "+        // Try to reenter",
              "+        Anyrand(anyrand).fulfillRandomness(",
              "+            requestId,",
              "+            address(this),",
              "+            bytes32(0),",
              "+            1,",
              "+            500_000,",
              "+            [uint256(0), uint256(0)]",
              "+        );",
              "+    }",
              "+}"
            ]
          }
        ]
      },
      {
        "filename": "exported/abi/AnyrandConsumer.json",
        "status": "modified",
        "additions": 19,
        "deletions": 0,
        "changes": 19,
        "blob_url_before": "https://github.com/frogworksio/anyrand/blob/c6f563fe90a7b35dc6d44827c0d3374751633819/exported/abi/AnyrandConsumer.json",
        "blob_url_after": "https://github.com/frogworksio/anyrand/blob/c529cb8fc697d60a6165c34815623c82f500cc3a/exported/abi/AnyrandConsumer.json",
        "hunks": [
          {
            "header": "@@ -95,6 +95,25 @@",
            "old_start_line": 95,
            "old_line_count": 6,
            "new_start_line": 95,
            "new_line_count": 25,
            "context": null,
            "lines": [
              "     \"stateMutability\": \"payable\",",
              "     \"type\": \"function\"",
              "   },",
              "+  {",
              "+    \"inputs\": [",
              "+      {",
              "+        \"internalType\": \"uint256\",",
              "+        \"name\": \"requestId\",",
              "+        \"type\": \"uint256\"",
              "+      }",
              "+    ],",
              "+    \"name\": \"getRandomReentrant\",",
              "+    \"outputs\": [",
              "+      {",
              "+        \"internalType\": \"uint256\",",
              "+        \"name\": \"\",",
              "+        \"type\": \"uint256\"",
              "+      }",
              "+    ],",
              "+    \"stateMutability\": \"view\",",
              "+    \"type\": \"function\"",
              "+  },",
              "   {",
              "     \"inputs\": [],",
              "     \"name\": \"owner\","
            ]
          }
        ]
      },
      {
        "filename": "package.json",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url_before": "https://github.com/frogworksio/anyrand/blob/c6f563fe90a7b35dc6d44827c0d3374751633819/package.json",
        "blob_url_after": "https://github.com/frogworksio/anyrand/blob/c529cb8fc697d60a6165c34815623c82f500cc3a/package.json",
        "hunks": [
          {
            "header": "@@ -39,7 +39,7 @@",
            "old_start_line": 39,
            "old_line_count": 7,
            "new_start_line": 39,
            "new_line_count": 7,
            "context": null,
            "lines": [
              "     \"chai\": \"^4.2.0\",",
              "     \"dotenv\": \"^16.3.1\",",
              "     \"ethers\": \"^6.11.1\",",
              "-    \"hardhat\": \"^2.22.1\",",
              "+    \"hardhat\": \"2.21.x\",",
              "     \"hardhat-abi-exporter\": \"^2.10.1\",",
              "     \"hardhat-contract-sizer\": \"^2.10.0\",",
              "     \"hardhat-gas-reporter\": \"^1.0.9\","
            ]
          }
        ]
      },
      {
        "filename": "test/Anyrand.spec.ts",
        "status": "modified",
        "additions": 28,
        "deletions": 2,
        "changes": 30,
        "blob_url_before": "https://github.com/frogworksio/anyrand/blob/c6f563fe90a7b35dc6d44827c0d3374751633819/test/Anyrand.spec.ts",
        "blob_url_after": "https://github.com/frogworksio/anyrand/blob/c529cb8fc697d60a6165c34815623c82f500cc3a/test/Anyrand.spec.ts",
        "hunks": [
          {
            "header": "@@ -6,14 +6,14 @@ import {",
            "old_start_line": 6,
            "old_line_count": 14,
            "new_start_line": 6,
            "new_line_count": 14,
            "context": "import {",
            "lines": [
              "     AnyrandConsumer__factory,",
              "     AnyrandHarness,",
              "     AnyrandHarness__factory,",
              "-    Anyrand__factory,",
              "     DrandBeacon,",
              "     Dummy__factory,",
              "     ERC1967Proxy__factory,",
              "     GasStationEthereum,",
              "+    ReentrantFulfiler__factory,",
              " } from '../typechain-types'",
              " import { SignerWithAddress } from '@nomicfoundation/hardhat-ethers/signers'",
              "-import { ZeroAddress, keccak256, parseEther, solidityPackedKeccak256 } from 'ethers'",
              "+import { ZeroAddress, keccak256, parseEther } from 'ethers'",
              " import { expect } from 'chai'",
              " import { bn254 } from '@kevincharm/noble-bn254-drand'",
              " import { deployAnyrandStack, G2, getHashedRoundMsg, getRound } from './helpers'"
            ]
          },
          {
            "header": "@@ -398,5 +398,31 @@ describe.only('Anyrand', () => {",
            "old_start_line": 398,
            "old_line_count": 5,
            "new_start_line": 398,
            "new_line_count": 31,
            "context": "describe.only('Anyrand', () => {",
            "lines": [
              "                 .to.emit(anyrand, 'RandomnessFulfilled')",
              "                 .withArgs(requestId, [randomness], true)",
              "         })",
              "+",
              "+        it('should revert if callback tries to reenter fulfillRandomness', async () => {",
              "+            const reentrantFulfiller = await new ReentrantFulfiler__factory(deployer).deploy(",
              "+                await anyrand.getAddress(),",
              "+            )",
              "+            await setBalance(await reentrantFulfiller.getAddress(), parseEther('10'))",
              "+            const deadline = BigInt(await time.latest()) + 30n",
              "+            const requestId = await anyrand.nextRequestId()",
              "+            const callbackGasLimit = 500_000n",
              "+            await reentrantFulfiller.getRandom(deadline, callbackGasLimit)",
              "+",
              "+            // Looped fulfillRandomness",
              "+            const pubKeyHash = await drandBeacon.publicKeyHash()",
              "+            const round = getRound(beaconGenesisTimestamp, deadline, beaconPeriod)",
              "+            const M = getHashedRoundMsg(round)",
              "+            const signature = bn254.signShortSignature(M, beaconSecretKey).toAffine()",
              "+            await expect(",
              "+                reentrantFulfiller.fulfillRandomness(",
              "+                    requestId,",
              "+                    pubKeyHash,",
              "+                    round,",
              "+                    callbackGasLimit,",
              "+                    [signature.x, signature.y],",
              "+                ),",
              "+            ).to.be.reverted // hh bug? nonReentrant reverts without a reason",
              "+        })",
              "     })",
              " })"
            ]
          }
        ]
      },
      {
        "filename": "yarn.lock",
        "status": "modified",
        "additions": 79,
        "deletions": 64,
        "changes": 143,
        "blob_url_before": "https://github.com/frogworksio/anyrand/blob/c6f563fe90a7b35dc6d44827c0d3374751633819/yarn.lock",
        "blob_url_after": "https://github.com/frogworksio/anyrand/blob/c529cb8fc697d60a6165c34815623c82f500cc3a/yarn.lock",
        "hunks": [
          {
            "header": "@@ -502,65 +502,65 @@",
            "old_start_line": 502,
            "old_line_count": 65,
            "new_start_line": 502,
            "new_line_count": 65,
            "context": null,
            "lines": [
              "     \"@nodelib/fs.scandir\" \"2.1.5\"",
              "     fastq \"^1.6.0\"",
              " ",
              "-\"@nomicfoundation/edr-darwin-arm64@0.3.2\":",
              "-  version \"0.3.2\"",
              "-  resolved \"https://registry.yarnpkg.com/@nomicfoundation/edr-darwin-arm64/-/edr-darwin-arm64-0.3.2.tgz#be1f696d429aecdf47d292a75958551e7cc34294\"",
              "-  integrity sha512-l6wfSBUUbGJiCENT6272CDI8yoMuf0sZH56H5qz3HnAyVzenkOvmzyF6/lar54m986kdAQqWls4cLvDxiOuLxg==",
              "-",
              "-\"@nomicfoundation/edr-darwin-x64@0.3.2\":",
              "-  version \"0.3.2\"",
              "-  resolved \"https://registry.yarnpkg.com/@nomicfoundation/edr-darwin-x64/-/edr-darwin-x64-0.3.2.tgz#efd2a5a302dc0a806fb2439a7e2c8ed7bd482ff8\"",
              "-  integrity sha512-OboExL7vEw+TRJQl3KkaEKU4K7PTdZPTInZ0fxMAtOpcWp7EKR+dQo68vc/iAOusB3xszHKxt7t+WpisItfdcg==",
              "-",
              "-\"@nomicfoundation/edr-linux-arm64-gnu@0.3.2\":",
              "-  version \"0.3.2\"",
              "-  resolved \"https://registry.yarnpkg.com/@nomicfoundation/edr-linux-arm64-gnu/-/edr-linux-arm64-gnu-0.3.2.tgz#4d7d4f28e13d426b5e3cf9731dbfed573f819245\"",
              "-  integrity sha512-xtEK+1eg++3pHi6405NDXd80S3CGOFEGQIyVGCwjMGQFOLSzBGGCsrb/0GB4J19zd1o/8ftCd/HjZcbVAWWTLQ==",
              "-",
              "-\"@nomicfoundation/edr-linux-arm64-musl@0.3.2\":",
              "-  version \"0.3.2\"",
              "-  resolved \"https://registry.yarnpkg.com/@nomicfoundation/edr-linux-arm64-musl/-/edr-linux-arm64-musl-0.3.2.tgz#10702ae4db386cc21efef9e6276bb56a09581e0a\"",
              "-  integrity sha512-3cIsskJOXQ1yEVsImmCacY7O03tUTiWrmd54F05PnPFrDLkjbzodQ3b2gUWzfbzUZWl67ZTJd1CvVSzpe7XGzw==",
              "-",
              "-\"@nomicfoundation/edr-linux-x64-gnu@0.3.2\":",
              "-  version \"0.3.2\"",
              "-  resolved \"https://registry.yarnpkg.com/@nomicfoundation/edr-linux-x64-gnu/-/edr-linux-x64-gnu-0.3.2.tgz#a29590bea8d490aa2129f2cb7fab1559ec9d25ee\"",
              "-  integrity sha512-ouPdphHNsyO7wqwa4hwahC5WqBglK/fIvMmhR/SXNZ9qruIpsA8ZZKIURaHMOv/2h2BbNGcyTX9uEk6+5rK/MQ==",
              "-",
              "-\"@nomicfoundation/edr-linux-x64-musl@0.3.2\":",
              "-  version \"0.3.2\"",
              "-  resolved \"https://registry.yarnpkg.com/@nomicfoundation/edr-linux-x64-musl/-/edr-linux-x64-musl-0.3.2.tgz#fe2b4c282c80c792b3a03e04d517d140a927cf92\"",
              "-  integrity sha512-sRhwhiPbkpJMOUwXW1FZw9ks6xWyQhIhM0E8o3TXEXKSPKTE6whQLEk1R37iFITaI36vb6rSwLKTU1cb32gCoA==",
              "-",
              "-\"@nomicfoundation/edr-win32-arm64-msvc@0.3.2\":",
              "-  version \"0.3.2\"",
              "-  resolved \"https://registry.yarnpkg.com/@nomicfoundation/edr-win32-arm64-msvc/-/edr-win32-arm64-msvc-0.3.2.tgz#6f09cf20f7e7be3ea70f61888cde238d924ec369\"",
              "-  integrity sha512-IEwVealKfumu1HSSnama26yPuQC/uthRPK5IWtFsQUOGwOXaS1r9Bu7cGYH2jBHl3IT/JbxD4xzPq/2pM9uK0A==",
              "-",
              "-\"@nomicfoundation/edr-win32-ia32-msvc@0.3.2\":",
              "-  version \"0.3.2\"",
              "-  resolved \"https://registry.yarnpkg.com/@nomicfoundation/edr-win32-ia32-msvc/-/edr-win32-ia32-msvc-0.3.2.tgz#ba4cd9744d95f491329efdfbefb527a8c9f5f31d\"",
              "-  integrity sha512-jYMnf6SFgguqROswwdsjJ1wvneD/5c16pVu9OD4DxNqhKNP5bHEw6L2N4DcJ89tpXMpJ6AlOpc0QuwzddiZ3tA==",
              "-",
              "-\"@nomicfoundation/edr-win32-x64-msvc@0.3.2\":",
              "-  version \"0.3.2\"",
              "-  resolved \"https://registry.yarnpkg.com/@nomicfoundation/edr-win32-x64-msvc/-/edr-win32-x64-msvc-0.3.2.tgz#331e3cea1618134e8d9f4ccb999086af6362a3af\"",
              "-  integrity sha512-Byn4QuWczRy/DUUQM3WjglgX/jGVUURVFaUsmIhnGg//MPlCLawubBGRqsrMuvaYedlIIJ4I2rgKvZlxdgHrqg==",
              "-",
              "-\"@nomicfoundation/edr@^0.3.1\":",
              "-  version \"0.3.2\"",
              "-  resolved \"https://registry.yarnpkg.com/@nomicfoundation/edr/-/edr-0.3.2.tgz#a81500746f8f8c342606a9be04a9f6176f8e2d54\"",
              "-  integrity sha512-HGWtjibAK1mo4I2A7nJ/fXqe/J9G54OrSPJnnkY2K8TiXotYLShGd9GvHkae3PuFjTJKm6ZgBy7tveJj5yrCfw==",
              "+\"@nomicfoundation/edr-darwin-arm64@0.2.1\":",
              "+  version \"0.2.1\"",
              "+  resolved \"https://registry.yarnpkg.com/@nomicfoundation/edr-darwin-arm64/-/edr-darwin-arm64-0.2.1.tgz#10c1a07add192583ce8b2d4cc93439f52b390a41\"",
              "+  integrity sha512-aMYaRaZVQ/TmyNJIoXf1bU4k0zfinaL9Sy1day4yGlL6eiQPFfRGj9W6TZaZIoYG0XTx/mQWD7dkXJ7LdrleJA==",
              "+",
              "+\"@nomicfoundation/edr-darwin-x64@0.2.1\":",
              "+  version \"0.2.1\"",
              "+  resolved \"https://registry.yarnpkg.com/@nomicfoundation/edr-darwin-x64/-/edr-darwin-x64-0.2.1.tgz#eaa29d2ba9f91ddb5f59b872c5a54f94a6fe3095\"",
              "+  integrity sha512-ma0SLcjHm5L3nPHcKFJB0jv/gKGSKaxr5Z65rurX/eaYUQJ7YGMsb8er9bSCo9rjzOtxf4FoPj3grL3zGpOj8A==",
              "+",
              "+\"@nomicfoundation/edr-linux-arm64-gnu@0.2.1\":",
              "+  version \"0.2.1\"",
              "+  resolved \"https://registry.yarnpkg.com/@nomicfoundation/edr-linux-arm64-gnu/-/edr-linux-arm64-gnu-0.2.1.tgz#8149db0d742157405effe82d485ea9bfefddc795\"",
              "+  integrity sha512-NX3G4pBhRitWrjSGY3HTyCq3wKSm5YqrKVOCNQGl9/jcjSovqxlgzFMiTx4YZCzGntfJ/1om9AI84OWxYJjoDw==",
              "+",
              "+\"@nomicfoundation/edr-linux-arm64-musl@0.2.1\":",
              "+  version \"0.2.1\"",
              "+  resolved \"https://registry.yarnpkg.com/@nomicfoundation/edr-linux-arm64-musl/-/edr-linux-arm64-musl-0.2.1.tgz#7d53afe5607eb406d199a199d00209a6304ff07b\"",
              "+  integrity sha512-gdQ3QHkt9XRkdtOGQ8fMwS11MXdjLeZgLrqoial4V4qtMaamIMMhVczK+VEvUhD8p7G4BVmp6kmkvcsthmndmw==",
              "+",
              "+\"@nomicfoundation/edr-linux-x64-gnu@0.2.1\":",
              "+  version \"0.2.1\"",
              "+  resolved \"https://registry.yarnpkg.com/@nomicfoundation/edr-linux-x64-gnu/-/edr-linux-x64-gnu-0.2.1.tgz#b762c95368fcb88bbbabba4d8be5380f38967413\"",
              "+  integrity sha512-OqabFY37vji6mYbLD9CvG28lja68czeVw58oWByIhFV3BpBu/cyP1oAbhzk3LieylujabS3Ekpvjw2Tkf0A9RQ==",
              "+",
              "+\"@nomicfoundation/edr-linux-x64-musl@0.2.1\":",
              "+  version \"0.2.1\"",
              "+  resolved \"https://registry.yarnpkg.com/@nomicfoundation/edr-linux-x64-musl/-/edr-linux-x64-musl-0.2.1.tgz#522448c42bff7d2abd52ddcf11ae6ca3dfdd6db4\"",
              "+  integrity sha512-vHfFFK2EPISuQUQge+bdjXamb0EUjfl8srYSog1qfiwyLwLeuSbpyyFzDeITAgPpkkFuedTfJW553K0Hipspyg==",
              "+",
              "+\"@nomicfoundation/edr-win32-arm64-msvc@0.2.1\":",
              "+  version \"0.2.1\"",
              "+  resolved \"https://registry.yarnpkg.com/@nomicfoundation/edr-win32-arm64-msvc/-/edr-win32-arm64-msvc-0.2.1.tgz#ccfa443c274e49de93016a1060be810096dc6f1d\"",
              "+  integrity sha512-K/mui67RCKxghbSyvhvW3rvyVN1pa9M1Q9APUx1PtWjSSdXDFpqEY1NYsv2syb47Ca8ObJwVMF+LvnB6GvhUOQ==",
              "+",
              "+\"@nomicfoundation/edr-win32-ia32-msvc@0.2.1\":",
              "+  version \"0.2.1\"",
              "+  resolved \"https://registry.yarnpkg.com/@nomicfoundation/edr-win32-ia32-msvc/-/edr-win32-ia32-msvc-0.2.1.tgz#822b19d3e67d6dcfa5394cb6a4d55d8bab1b2f26\"",
              "+  integrity sha512-HHK0mXEtjvfjJrJlqcYgQCy3lZIXS1KNl2GaP8bwEIuEwx++XxXs/ThLjPepM1nhCGICij8IGy7p3KrkzRelsw==",
              "+",
              "+\"@nomicfoundation/edr-win32-x64-msvc@0.2.1\":",
              "+  version \"0.2.1\"",
              "+  resolved \"https://registry.yarnpkg.com/@nomicfoundation/edr-win32-x64-msvc/-/edr-win32-x64-msvc-0.2.1.tgz#7b56ff742b2724779cc9f3385815b394f76de8df\"",
              "+  integrity sha512-FY4eQJdj1/y8ST0RyQycx63yr+lvdYNnUkzgWf4X+vPH1lOhXae+L2NDcNCQlTDAfQcD6yz0bkBUkLrlJ8pTww==",
              "+",
              "+\"@nomicfoundation/edr@^0.2.0\":",
              "+  version \"0.2.1\"",
              "+  resolved \"https://registry.yarnpkg.com/@nomicfoundation/edr/-/edr-0.2.1.tgz#a3d2a542dcd5dc5a8d757116d52baea05f370531\"",
              "+  integrity sha512-Dleau3ItHJh2n85G2J6AIPBoLgu/mOWkmrh26z3VsJE2tp/e00hUk/dqz85ncsVcBYEc6/YOn/DomWu0wSF9tQ==",
              "   optionalDependencies:",
              "-    \"@nomicfoundation/edr-darwin-arm64\" \"0.3.2\"",
              "-    \"@nomicfoundation/edr-darwin-x64\" \"0.3.2\"",
              "-    \"@nomicfoundation/edr-linux-arm64-gnu\" \"0.3.2\"",
              "-    \"@nomicfoundation/edr-linux-arm64-musl\" \"0.3.2\"",
              "-    \"@nomicfoundation/edr-linux-x64-gnu\" \"0.3.2\"",
              "-    \"@nomicfoundation/edr-linux-x64-musl\" \"0.3.2\"",
              "-    \"@nomicfoundation/edr-win32-arm64-msvc\" \"0.3.2\"",
              "-    \"@nomicfoundation/edr-win32-ia32-msvc\" \"0.3.2\"",
              "-    \"@nomicfoundation/edr-win32-x64-msvc\" \"0.3.2\"",
              "+    \"@nomicfoundation/edr-darwin-arm64\" \"0.2.1\"",
              "+    \"@nomicfoundation/edr-darwin-x64\" \"0.2.1\"",
              "+    \"@nomicfoundation/edr-linux-arm64-gnu\" \"0.2.1\"",
              "+    \"@nomicfoundation/edr-linux-arm64-musl\" \"0.2.1\"",
              "+    \"@nomicfoundation/edr-linux-x64-gnu\" \"0.2.1\"",
              "+    \"@nomicfoundation/edr-linux-x64-musl\" \"0.2.1\"",
              "+    \"@nomicfoundation/edr-win32-arm64-msvc\" \"0.2.1\"",
              "+    \"@nomicfoundation/edr-win32-ia32-msvc\" \"0.2.1\"",
              "+    \"@nomicfoundation/edr-win32-x64-msvc\" \"0.2.1\"",
              " ",
              " \"@nomicfoundation/ethereumjs-common@4.0.4\":",
              "   version \"4.0.4\""
            ]
          },
          {
            "header": "@@ -1440,7 +1440,7 @@ check-error@^1.0.2, check-error@^1.0.3:",
            "old_start_line": 1440,
            "old_line_count": 7,
            "new_start_line": 1440,
            "new_line_count": 7,
            "context": "check-error@^1.0.2, check-error@^1.0.3:",
            "lines": [
              "   dependencies:",
              "     get-func-name \"^2.0.2\"",
              " ",
              "-chokidar@3.5.3, chokidar@^3.4.0:",
              "+chokidar@3.5.3:",
              "   version \"3.5.3\"",
              "   resolved \"https://registry.yarnpkg.com/chokidar/-/chokidar-3.5.3.tgz#1cf37c8707b932bd1af1ae22c0432e2acd1903bd\"",
              "   integrity sha512-Dr3sfKRP6oTcjf2JmUmFJfeVMvXBdegxB0iVQ5eb2V10uFJUCAS8OByZdVAyVb8xXNz3GjjTgj9kLWsZTqE6kw=="
            ]
          },
          {
            "header": "@@ -1455,6 +1455,21 @@ chokidar@3.5.3, chokidar@^3.4.0:",
            "old_start_line": 1455,
            "old_line_count": 6,
            "new_start_line": 1455,
            "new_line_count": 21,
            "context": "chokidar@3.5.3, chokidar@^3.4.0:",
            "lines": [
              "   optionalDependencies:",
              "     fsevents \"~2.3.2\"",
              " ",
              "+chokidar@^3.4.0:",
              "+  version \"3.6.0\"",
              "+  resolved \"https://registry.yarnpkg.com/chokidar/-/chokidar-3.6.0.tgz#197c6cc669ef2a8dc5e7b4d97ee4e092c3eb0d5b\"",
              "+  integrity sha512-7VT13fmjotKpGipCW9JEQAusEPE+Ei8nl6/g4FBAmIm0GOOLMua9NDDo/DWp0ZAxCr3cPq5ZpBqmPAQgDda2Pw==",
              "+  dependencies:",
              "+    anymatch \"~3.1.2\"",
              "+    braces \"~3.0.2\"",
              "+    glob-parent \"~5.1.2\"",
              "+    is-binary-path \"~2.1.0\"",
              "+    is-glob \"~4.0.1\"",
              "+    normalize-path \"~3.0.0\"",
              "+    readdirp \"~3.6.0\"",
              "+  optionalDependencies:",
              "+    fsevents \"~2.3.2\"",
              "+",
              " ci-info@^2.0.0:",
              "   version \"2.0.0\"",
              "   resolved \"https://registry.yarnpkg.com/ci-info/-/ci-info-2.0.0.tgz#67a9e964be31a51e15e5010d58e6f12834002f46\""
            ]
          },
          {
            "header": "@@ -2329,14 +2344,14 @@ hardhat-storage-layout@^0.1.7:",
            "old_start_line": 2329,
            "old_line_count": 14,
            "new_start_line": 2344,
            "new_line_count": 14,
            "context": "hardhat-storage-layout@^0.1.7:",
            "lines": [
              "   dependencies:",
              "     console-table-printer \"^2.9.0\"",
              " ",
              "-hardhat@^2.22.1:",
              "-  version \"2.22.1\"",
              "-  resolved \"https://registry.yarnpkg.com/hardhat/-/hardhat-2.22.1.tgz#2640ecc6ff655dea883a25a8b17f1e70e45e6756\"",
              "-  integrity sha512-cTWYIJc5jQ132XUI8oRI/TO9L6oavPoJRCTRU9sIjkVxvkxz0Axz0K83Z3BEdJTqBQ2W84ZRoTekti84kBwCjg==",
              "+hardhat@2.21.x:",
              "+  version \"2.21.0\"",
              "+  resolved \"https://registry.yarnpkg.com/hardhat/-/hardhat-2.21.0.tgz#2e23126310a6c77cd7e149e6af1dd67626b7a74f\"",
              "+  integrity sha512-8DlJAVJDEVHaV1sh9FLuKLLgCFv9EAJ+M+8IbjSIPgoeNo3ss5L1HgGBMfnI88c7OzMEZkdcuyGoobFeK3Orqw==",
              "   dependencies:",
              "     \"@ethersproject/abi\" \"^5.1.2\"",
              "     \"@metamask/eth-sig-util\" \"^4.0.0\"",
              "-    \"@nomicfoundation/edr\" \"^0.3.1\"",
              "+    \"@nomicfoundation/edr\" \"^0.2.0\"",
              "     \"@nomicfoundation/ethereumjs-common\" \"4.0.4\"",
              "     \"@nomicfoundation/ethereumjs-tx\" \"5.0.4\"",
              "     \"@nomicfoundation/ethereumjs-util\" \"9.0.4\""
            ]
          }
        ]
      }
    ]
  },
  {
    "commit_url": "https://github.com/frogworksio/anyrand/commit/ad3387b39b686861b413c2d209719946b3e72cf3",
    "sha": "ad3387b39b686861b413c2d209719946b3e72cf3",
    "parent_sha": "678b3fbb26f0d325ab04a5d4be429781eb8892eb",
    "message": "always cap computed request price",
    "score": 0.05,
    "files": [
      {
        "filename": "contracts/Anyrand.sol",
        "status": "modified",
        "additions": 11,
        "deletions": 10,
        "changes": 21,
        "blob_url_before": "https://github.com/frogworksio/anyrand/blob/678b3fbb26f0d325ab04a5d4be429781eb8892eb/contracts/Anyrand.sol",
        "blob_url_after": "https://github.com/frogworksio/anyrand/blob/ad3387b39b686861b413c2d209719946b3e72cf3/contracts/Anyrand.sol",
        "hunks": [
          {
            "header": "@@ -132,6 +132,15 @@ contract Anyrand is",
            "old_start_line": 132,
            "old_line_count": 6,
            "new_start_line": 132,
            "new_line_count": 15,
            "context": "contract Anyrand is",
            "lines": [
              "                 200_000 /** fulfillRandomness overhead */ + callbackGasLimit",
              "             );",
              "         uint256 totalCost = (rawTxCost * $.requestPremiumMultiplierBps) / 1e4;",
              "+        if (effectiveFeePerGas > $.maxFeePerGas) {",
              "+            // Cap gas price at maxFeePerGas (keeper will only fulfill when gas",
              "+            // price <= maxFeePerGas)",
              "+            // Importantly, fulfilment is permissionless, so it's possible to",
              "+            // override this behaviour and fulfill randomness even when the",
              "+            // keeper refuses to.",
              "+            totalCost = $.maxFeePerGas * callbackGasLimit;",
              "+            effectiveFeePerGas = $.maxFeePerGas;",
              "+        }",
              "         return (totalCost, effectiveFeePerGas);",
              "     }",
              " "
            ]
          },
          {
            "header": "@@ -151,19 +160,11 @@ contract Anyrand is",
            "old_start_line": 151,
            "old_line_count": 19,
            "new_start_line": 160,
            "new_line_count": 11,
            "context": "contract Anyrand is",
            "lines": [
              "         (uint256 reqPrice, uint256 effectiveFeePerGas) = getRequestPrice(",
              "             callbackGasLimit",
              "         );",
              "-        MainStorage storage $ = _getMainStorage();",
              "-        if (effectiveFeePerGas > $.maxFeePerGas) {",
              "-            // Cap gas price at maxFeePerGas (keeper will only fulfill when gas",
              "-            // price <= maxFeePerGas)",
              "-            // Importantly, fulfilment is permissionless, so it's possible to",
              "-            // override this behaviour and fulfill randomness even when the",
              "-            // keeper refuses to.",
              "-            reqPrice = $.maxFeePerGas * callbackGasLimit;",
              "-            effectiveFeePerGas = $.maxFeePerGas;",
              "-        }",
              "         if (msg.value != reqPrice) {",
              "             revert IncorrectPayment(msg.value, reqPrice);",
              "         }",
              "+",
              "+        MainStorage storage $ = _getMainStorage();",
              "         if (callbackGasLimit > $.maxCallbackGasLimit) {",
              "             revert OverGasLimit(callbackGasLimit);",
              "         }"
            ]
          }
        ]
      }
    ]
  },
  {
    "commit_url": "https://github.com/frogworksio/anyrand/commit/49d2fe4b7c4115aeebaf3a7915902097964ad9ce",
    "sha": "49d2fe4b7c4115aeebaf3a7915902097964ad9ce",
    "parent_sha": "68e738dbfb5936391ec94496392f4d9a9ec4a4ef",
    "message": "use SSTORE2 to store beacon data",
    "score": 0.05,
    "files": [
      {
        "filename": "contracts/Anyrand.sol",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url_before": "https://github.com/frogworksio/anyrand/blob/68e738dbfb5936391ec94496392f4d9a9ec4a4ef/contracts/Anyrand.sol",
        "blob_url_after": "https://github.com/frogworksio/anyrand/blob/49d2fe4b7c4115aeebaf3a7915902097964ad9ce/contracts/Anyrand.sol",
        "hunks": [
          {
            "header": "@@ -150,7 +150,7 @@ contract Anyrand is AnyrandStorage, Ownable {",
            "old_start_line": 150,
            "old_line_count": 7,
            "new_start_line": 150,
            "new_line_count": 7,
            "context": "contract Anyrand is AnyrandStorage, Ownable {",
            "lines": [
              "         $.requests[requestId] = hashRequest(",
              "             requestId,",
              "             msg.sender,",
              "-            beacon.getPublicKeyHash(),",
              "+            beacon.publicKeyHash(),",
              "             round,",
              "             callbackGasLimit",
              "         );"
            ]
          },
          {
            "header": "@@ -174,7 +174,7 @@ contract Anyrand is AnyrandStorage, Ownable {",
            "old_start_line": 174,
            "old_line_count": 7,
            "new_start_line": 174,
            "new_line_count": 7,
            "context": "contract Anyrand is AnyrandStorage, Ownable {",
            "lines": [
              "             uint256 pubKey2,",
              "             uint256 pubKey3",
              "         ) = abi.decode(",
              "-                IDrandBeacon(_getMainStorage().beacon).getPublicKey(),",
              "+                IDrandBeacon(_getMainStorage().beacon).publicKey(),",
              "                 (uint256, uint256, uint256, uint256)",
              "             );",
              "         return [pubKey0, pubKey1, pubKey2, pubKey3];"
            ]
          }
        ]
      },
      {
        "filename": "contracts/beacon/DrandBeacon.sol",
        "status": "modified",
        "additions": 63,
        "deletions": 22,
        "changes": 85,
        "blob_url_before": "https://github.com/frogworksio/anyrand/blob/68e738dbfb5936391ec94496392f4d9a9ec4a4ef/contracts/beacon/DrandBeacon.sol",
        "blob_url_after": "https://github.com/frogworksio/anyrand/blob/49d2fe4b7c4115aeebaf3a7915902097964ad9ce/contracts/beacon/DrandBeacon.sol",
        "hunks": [
          {
            "header": "@@ -2,24 +2,31 @@",
            "old_start_line": 2,
            "old_line_count": 24,
            "new_start_line": 2,
            "new_line_count": 31,
            "context": null,
            "lines": [
              " pragma solidity 0.8.23;",
              " ",
              " import {BLS} from \"@kevincharm/bls-bn254/contracts/BLS.sol\";",
              "+import {SSTORE2} from \"solady/src/utils/SSTORE2.sol\";",
              " import {IDrandBeacon} from \"../interfaces/IDrandBeacon.sol\";",
              " ",
              " /// @title DrandBeacon",
              " /// @author Kevin Charm <kevin@frogworks.io>",
              " /// @notice Contract containing immutable information about a drand beacon.",
              " contract DrandBeacon is IDrandBeacon {",
              "-    /// @notice Group PK Re(x) in G2",
              "-    uint256 public immutable publicKey0;",
              "-    /// @notice Group PK Im(x) in G2",
              "-    uint256 public immutable publicKey1;",
              "-    /// @notice Group PK Re(y) in G2",
              "-    uint256 public immutable publicKey2;",
              "-    /// @notice Group PK Im(y) in G2",
              "-    uint256 public immutable publicKey3;",
              "-    /// @notice The beacon's period, in seconds",
              "-    uint256 public immutable period;",
              "-    /// @notice Genesis timestamp",
              "-    uint256 public immutable genesisTimestamp;",
              "+    /**",
              "+     * ---------------------+-------+",
              "+     * var                  |  size |",
              "+     * ---------------------+-------+",
              "+     * publicKey            |   128 |",
              "+     * genesisTimestamp     |    32 |",
              "+     * period               |    32 |",
              "+     * ---------------------+-------+",
              "+     */",
              "+    uint256 private constant PTR_PUBLIC_KEY = 0;",
              "+    uint256 private constant LEN_PUBLIC_KEY = 128;",
              "+    uint256 private constant PTR_GENESIS_TIMESTAMP = 128;",
              "+    uint256 private constant LEN_GENESIS_TIMESTAMP = 32;",
              "+    uint256 private constant PTR_PERIOD = 160;",
              "+    uint256 private constant LEN_PERIOD = 32;",
              "+",
              "+    /// @notice Pointer to immutable data",
              "+    address public immutable data;",
              " ",
              "     error InvalidPublicKey(uint256[4] pubKey);",
              "     error InvalidBeaconConfiguration(uint256 genesisTimestamp, uint256 period);"
            ]
          },
          {
            "header": "@@ -32,23 +39,57 @@ contract DrandBeacon is IDrandBeacon {",
            "old_start_line": 32,
            "old_line_count": 23,
            "new_start_line": 39,
            "new_line_count": 57,
            "context": "contract DrandBeacon is IDrandBeacon {",
            "lines": [
              "         if (!BLS.isValidPublicKey(publicKey_)) {",
              "             revert InvalidPublicKey(publicKey_);",
              "         }",
              "-        publicKey0 = publicKey_[0];",
              "-        publicKey1 = publicKey_[1];",
              "-        publicKey2 = publicKey_[2];",
              "-        publicKey3 = publicKey_[3];",
              "+        bytes memory pubKey = abi.encodePacked(",
              "+            publicKey_[0],",
              "+            publicKey_[1],",
              "+            publicKey_[2],",
              "+            publicKey_[3]",
              "+        );",
              " ",
              "         if (genesisTimestamp_ == 0 || period_ == 0) {",
              "             revert InvalidBeaconConfiguration(genesisTimestamp_, period_);",
              "         }",
              "-        genesisTimestamp = genesisTimestamp_;",
              "-        period = period_;",
              "+",
              "+        data = SSTORE2.write(",
              "+            abi.encodePacked(pubKey, genesisTimestamp_, period_)",
              "+        );",
              "+",
              "+        // Sanity checks",
              "+        assert(keccak256(publicKey()) == keccak256(pubKey));",
              "+        assert(genesisTimestamp() == genesisTimestamp_);",
              "+        assert(period() == period_);",
              "+    }",
              "+",
              "+    /// @notice Get the public key of the beacon",
              "+    function publicKey() public view returns (bytes memory) {",
              "+        return",
              "+            SSTORE2.read(data, PTR_PUBLIC_KEY, PTR_PUBLIC_KEY + LEN_PUBLIC_KEY);",
              "+    }",
              "+",
              "+    /// @notice Get the public key hash of the beacon",
              "+    function publicKeyHash() public view returns (bytes32) {",
              "+        return keccak256(publicKey());",
              "     }",
              " ",
              "-    function getPublicKey() public view returns (bytes memory) {",
              "-        return abi.encodePacked(publicKey0, publicKey1, publicKey2, publicKey3);",
              "+    /// @notice Get the genesis timestamp of the beacon",
              "+    function genesisTimestamp() public view returns (uint256) {",
              "+        return",
              "+            abi.decode(",
              "+                SSTORE2.read(",
              "+                    data,",
              "+                    PTR_GENESIS_TIMESTAMP,",
              "+                    PTR_GENESIS_TIMESTAMP + LEN_GENESIS_TIMESTAMP",
              "+                ),",
              "+                (uint256)",
              "+            );",
              "     }",
              " ",
              "-    function getPublicKeyHash() public view returns (bytes32) {",
              "-        return keccak256(getPublicKey());",
              "+    /// @notice Get the period of the beacon",
              "+    function period() public view returns (uint256) {",
              "+        return",
              "+            abi.decode(",
              "+                SSTORE2.read(data, PTR_PERIOD, PTR_PERIOD + LEN_PERIOD),",
              "+                (uint256)",
              "+            );",
              "     }",
              " }"
            ]
          }
        ]
      },
      {
        "filename": "contracts/interfaces/IDrandBeacon.sol",
        "status": "modified",
        "additions": 7,
        "deletions": 7,
        "changes": 14,
        "blob_url_before": "https://github.com/frogworksio/anyrand/blob/68e738dbfb5936391ec94496392f4d9a9ec4a4ef/contracts/interfaces/IDrandBeacon.sol",
        "blob_url_after": "https://github.com/frogworksio/anyrand/blob/49d2fe4b7c4115aeebaf3a7915902097964ad9ce/contracts/interfaces/IDrandBeacon.sol",
        "hunks": [
          {
            "header": "@@ -5,15 +5,15 @@ pragma solidity ^0.8;",
            "old_start_line": 5,
            "old_line_count": 15,
            "new_start_line": 5,
            "new_line_count": 15,
            "context": "pragma solidity ^0.8;",
            "lines": [
              " /// @author Kevin Charm (kevin@frogworks.io)",
              " /// @notice Contract containing immutable information about a drand beacon.",
              " interface IDrandBeacon {",
              "-    /// @notice Get the period of the beacon",
              "-    function period() external view returns (uint256);",
              "+    /// @notice Get the public key of the beacon",
              "+    function publicKey() external view returns (bytes memory);",
              "+",
              "+    /// @notice Get the public key hash of the beacon",
              "+    function publicKeyHash() external view returns (bytes32);",
              " ",
              "     /// @notice Get the genesis timestamp of the beacon",
              "     function genesisTimestamp() external view returns (uint256);",
              " ",
              "-    /// @notice Get the public key of the beacon",
              "-    function getPublicKey() external view returns (bytes memory);",
              "-",
              "-    /// @notice Get the public key hash of the beacon",
              "-    function getPublicKeyHash() external view returns (bytes32);",
              "+    /// @notice Get the period of the beacon",
              "+    function period() external view returns (uint256);",
              " }"
            ]
          }
        ]
      },
      {
        "filename": "package.json",
        "status": "modified",
        "additions": 8,
        "deletions": 2,
        "changes": 10,
        "blob_url_before": "https://github.com/frogworksio/anyrand/blob/68e738dbfb5936391ec94496392f4d9a9ec4a4ef/package.json",
        "blob_url_after": "https://github.com/frogworksio/anyrand/blob/49d2fe4b7c4115aeebaf3a7915902097964ad9ce/package.json",
        "hunks": [
          {
            "header": "@@ -14,7 +14,13 @@",
            "old_start_line": 14,
            "old_line_count": 7,
            "new_start_line": 14,
            "new_line_count": 13,
            "context": null,
            "lines": [
              "     \"test\": \"yarn hardhat --network hardhat test\",",
              "     \"coverage\": \"yarn hardhat --network hardhat coverage\"",
              "   },",
              "-  \"keywords\": [\"solidity\", \"vrf\", \"drand\", \"bls\", \"bn254\"],",
              "+  \"keywords\": [",
              "+    \"solidity\",",
              "+    \"vrf\",",
              "+    \"drand\",",
              "+    \"bls\",",
              "+    \"bn254\"",
              "+  ],",
              "   \"author\": \"Kevin Charm <kevin@frogworks.io>\",",
              "   \"license\": \"UNLICENSED\",",
              "   \"devDependencies\": {"
            ]
          },
          {
            "header": "@@ -53,7 +59,7 @@",
            "old_start_line": 53,
            "old_line_count": 7,
            "new_start_line": 59,
            "new_line_count": 7,
            "context": null,
            "lines": [
              "     \"@openzeppelin/contracts\": \"^5.0.0\",",
              "     \"@openzeppelin/contracts-upgradeable\": \"^5.0.0\",",
              "     \"@scroll-tech/contracts\": \"^0.1.0\",",
              "-    \"solady\": \"^0.0.201\"",
              "+    \"solady\": \"^0.0.245\"",
              "   },",
              "   \"packageManager\": \"yarn@1.22.22+sha512.a6b2f7906b721bba3d67d4aff083df04dad64c399707841b7acf00f6b133b7ac24255f2652fa22ae3534329dc6180534e98d17432037ff6fd140556e2bb3137e\"",
              " }"
            ]
          }
        ]
      },
      {
        "filename": "test/Anyrand.spec.ts",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url_before": "https://github.com/frogworksio/anyrand/blob/68e738dbfb5936391ec94496392f4d9a9ec4a4ef/test/Anyrand.spec.ts",
        "blob_url_after": "https://github.com/frogworksio/anyrand/blob/49d2fe4b7c4115aeebaf3a7915902097964ad9ce/test/Anyrand.spec.ts",
        "hunks": [
          {
            "header": "@@ -96,7 +96,7 @@ describe('Anyrand', () => {",
            "old_start_line": 96,
            "old_line_count": 7,
            "new_start_line": 96,
            "new_line_count": 7,
            "context": "describe('Anyrand', () => {",
            "lines": [
              "         const fulfillRandomnessArgs: Parameters<typeof anyrand.fulfillRandomness> = [",
              "             requestId,",
              "             requester,",
              "-            await drandBeacon.getPublicKeyHash(),",
              "+            await drandBeacon.publicKeyHash(),",
              "             round,",
              "             callbackGasLimit,",
              "             [roundBeacon.signature.x, roundBeacon.signature.y],"
            ]
          }
        ]
      },
      {
        "filename": "yarn.lock",
        "status": "modified",
        "additions": 4,
        "deletions": 4,
        "changes": 8,
        "blob_url_before": "https://github.com/frogworksio/anyrand/blob/68e738dbfb5936391ec94496392f4d9a9ec4a4ef/yarn.lock",
        "blob_url_after": "https://github.com/frogworksio/anyrand/blob/49d2fe4b7c4115aeebaf3a7915902097964ad9ce/yarn.lock",
        "hunks": [
          {
            "header": "@@ -3484,10 +3484,10 @@ slice-ansi@^4.0.0:",
            "old_start_line": 3484,
            "old_line_count": 10,
            "new_start_line": 3484,
            "new_line_count": 10,
            "context": "slice-ansi@^4.0.0:",
            "lines": [
              "     astral-regex \"^2.0.0\"",
              "     is-fullwidth-code-point \"^3.0.0\"",
              " ",
              "-solady@^0.0.201:",
              "-  version \"0.0.201\"",
              "-  resolved \"https://registry.yarnpkg.com/solady/-/solady-0.0.201.tgz#278bcf859bc2bafe02c571c8fd4c4dededae836f\"",
              "-  integrity sha512-5K0abYDz4y/XwylslIZ1yEeh2xDsFfgmF3sPNhT8z4cQcX/ucz0ImyRfQHnc31J1j1MGuuQTdtSxz3Sfbz9FDQ==",
              "+solady@^0.0.245:",
              "+  version \"0.0.245\"",
              "+  resolved \"https://registry.yarnpkg.com/solady/-/solady-0.0.245.tgz#25a14ddfde9407f911d2b49cd9aeb55fe59d6ec7\"",
              "+  integrity sha512-4Fegm1uYm1mrtIceCmLCjzbyl2V70+Issd1QQAtnPVr9fsc/Frk4yGoCV+UMd8s59h3FzqbrLcMoC//uFfDV4w==",
              " ",
              " solc@0.7.3:",
              "   version \"0.7.3\""
            ]
          }
        ]
      }
    ]
  },
  {
    "commit_url": "https://github.com/frogworksio/anyrand/commit/4ccb510394b9ecb85d799ead66a9c17fb5fdb8ca",
    "sha": "4ccb510394b9ecb85d799ead66a9c17fb5fdb8ca",
    "parent_sha": "a48f47c84c945d0729515324d51780ab3a9c6c56",
    "message": "H-1: fix beacon round calculation",
    "score": 0.95,
    "files": [
      {
        "filename": "contracts/Anyrand.sol",
        "status": "modified",
        "additions": 16,
        "deletions": 2,
        "changes": 18,
        "blob_url_before": "https://github.com/frogworksio/anyrand/blob/a48f47c84c945d0729515324d51780ab3a9c6c56/contracts/Anyrand.sol",
        "blob_url_after": "https://github.com/frogworksio/anyrand/blob/4ccb510394b9ecb85d799ead66a9c17fb5fdb8ca/contracts/Anyrand.sol",
        "hunks": [
          {
            "header": "@@ -144,6 +144,21 @@ contract Anyrand is",
            "old_start_line": 144,
            "old_line_count": 6,
            "new_start_line": 144,
            "new_line_count": 21,
            "context": "contract Anyrand is",
            "lines": [
              "         return (totalCost, effectiveFeePerGas);",
              "     }",
              " ",
              "+    /// @notice Compute the drand beacon round given a genesis timestamp,",
              "+    ///     deadline and period.",
              "+    /// @param genesis The genesis timestamp of the drand beacon",
              "+    /// @param deadline The deadline timestamp after which the randomness will",
              "+    ///     be available",
              "+    /// @param period The period of the drand beacon",
              "+    function getRound(",
              "+        uint256 genesis,",
              "+        uint256 deadline,",
              "+        uint256 period",
              "+    ) public pure returns (uint64) {",
              "+        uint256 delta = deadline - genesis;",
              "+        return uint64(delta / period + (delta % period > 0 ? 1 : 0));",
              "+    }",
              "+",
              "     /// @notice Request randomness. Note that the fulfilment of the request will",
              "     ///     always be *after* the deadline, but never before.",
              "     /// @param deadline Timestamp of when the randomness should be fulfilled. A"
            ]
          },
          {
            "header": "@@ -185,8 +200,7 @@ contract Anyrand is",
            "old_start_line": 185,
            "old_line_count": 8,
            "new_start_line": 200,
            "new_line_count": 7,
            "context": "contract Anyrand is",
            "lines": [
              "                 revert InvalidDeadline(deadline);",
              "             }",
              "             // Calculate nearest round from deadline (rounding to the future)",
              "-            uint256 delta = deadline - genesis;",
              "-            round = uint64((delta / period) + (delta % period));",
              "+            round = getRound(genesis, deadline, period);",
              "         }",
              " ",
              "         // Record the commitment of this request"
            ]
          }
        ]
      }
    ]
  }
]